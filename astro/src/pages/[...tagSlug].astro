---
import { client } from "../data/_sanityClient";
import { generateSlug } from "../data/_utils";
import BaseLayout from "../layouts/BaseLayout.astro";
import { getTagPageData } from "../data/tag";
import Breadcrumbs from "../components/Breadcrumbs.astro";
import SiteHeader from "../components/SiteHeader.astro";
import SiteFooter from "../components/SiteFooter.astro";

export async function getStaticPaths() {
    const data = await client.fetch(
        `*[_type == "tag"] { _id, "slug": slug.current }`,
    );

    return await Promise.all(
        data.map(async (result: any) => {
            let tag = await getTagPageData(result.slug);
            const slugData = await generateSlug(result._id);
            const slug = slugData.slug.replace("/", "");

            return {
                params: {
                    tagSlug: slug,
                },
                props: {
                    tag: tag
                },
            };
        }),
    );
}

let { tag } = Astro.props;
---

<BaseLayout metaTitle={tag.title}>
    <div class="l-site">
        <SiteHeader />
        <main>
            <div class="l-constraint">
                <Breadcrumbs items={tag.breadcrumbs} current={tag.title} />
                <div class="archive-page">
                    <header class="archive-page__header">
                        <h2 class="archive-page__title">
                            {tag.title}
                        </h2>
                        <div class="archive-page__intro | u-rich-text">
                            {tag.type === "creation" ? "Creations" : "Posts"}
                            tagged "{tag.title}"
                        </div>
                    </header>
                    {
                        tag.type === "article" ? (
                            <div class="posts">
                                <ul class="posts-list">
                                </ul>
                            </div>
                        ) : (
                            <div class="projects">
                                <ul class="projects__list">

                                </ul>
                            </div>
                        )
                    }
                </div>
            </div>
        </main>
        <SiteFooter />
    </div>
</BaseLayout>
